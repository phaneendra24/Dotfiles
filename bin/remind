#!/bin/bash
# remind - Simple reminder utility with desktop notifications
# Usage: remind <time> "message"
# Time formats: 5m, 2h, 30s, 1h30m, etc.

# Time parsing function
parse_time() {
    local input="$1"
    local total_seconds=0
    
    # Extract numbers and units using regex
    while [[ $input =~ ^([0-9]+)([smhd]) ]]; do
        local value="${BASH_REMATCH[1]}"
        local unit="${BASH_REMATCH[2]}"
        
        case "$unit" in
            s) total_seconds=$((total_seconds + value)) ;;
            m) total_seconds=$((total_seconds + value * 60)) ;;
            h) total_seconds=$((total_seconds + value * 3600)) ;;
            d) total_seconds=$((total_seconds + value * 86400)) ;;
        esac
        
        # Remove matched part from input
        input="${input:${#BASH_REMATCH[0]}}"
    done
    
    echo "$total_seconds"
}

# Notification function
send_notification() {
    local message="$1"
    
    if command -v notify-send &> /dev/null; then
        # Linux with notify-send
        notify-send "⏰ Reminder" "$message" --icon=dialog-information
    elif command -v osascript &> /dev/null; then
        # macOS
        osascript -e "display notification \"$message\" with title \"Reminder\""
    else
        # Terminal fallback
        echo -e "\a"  # Bell sound
        echo -e "\n\033[1;33m⏰ REMINDER: $message\033[0m\n"
    fi
}

# Main logic
if [ $# -lt 2 ]; then
    echo "Usage: remind <time> \"message\""
    echo "  Time formats: 5m, 2h, 1h30m, 30s, etc."
    exit 1
fi

time_input="$1"
message="$2"
seconds=$(parse_time "$time_input")

if [ "$seconds" -eq 0 ]; then
    echo "Error: Invalid time format. Use like: 5m, 2h, 1h30m"
    exit 1
fi

echo "⏰ Reminder set for ${time_input} (${seconds}s): $message"

# Run in background so terminal stays free
(
    sleep "$seconds"
    send_notification "$message"
) & disown
